<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="data Visualisation D3 updates and Transitions">
    <meta name="keywords" content="html,css,d3">
    <meta name="author" content="V.M.Karthikeyan">

    <title>Task 5.2 D3 Updates and Transistions</title>
     <!--Link to external D3 library-->
    <script src="https://d3js.org/d3.v7.min.js"></script>


    
</head>

<body>


    <h1>Updates with Bar chart</h1>
    <br>
    <div id="button"> 
        <button id="update">Update</button>
        <button id="transition1">Transition 1</button>
        <button id="transition2">Transition 2</button>
    </div><br>

    <script>
        var w = 500; //width variable of svg canvas
        var h = 200;//height variable of svg canvas
        var padding = 14; //padding 

        var dataset = [24,10,29,19,8,15,20,12,9,6,21,28];

        var xScale = d3.scaleBand() //scaling for ordinal data
                        .domain(d3.range(dataset.length)) //calculate domain range
                        .rangeRound([0,w]) //round out dataset and specify the size
                        .paddingInner(0.05); //padding
        
        var yScale = d3.scaleLinear()
                        .domain([0,d3.max(dataset)]) //domain range for y axis
                        .rangeRound([0,h]);

        var svg = d3.select("body") //create an svg canvas through d3
                    .append("svg")
                    .attr("width",w)
                    .attr("height",h);

        svg.selectAll("rect") // create rctangle shapes bind it to values in the dataset
            .data(dataset)
            .enter()
            .append("rect")
            .style("fill","blue")
            .attr("x",function(d,i){ //function to adjust width of the rectangles according to the number of values
                return xScale(i);
            })
            .attr("y",function(d){//function to invert the shapes to make it vertical 
                return h-yScale(d); 
            })
            .attr("width",xScale.bandwidth())  //maintain constant width
            .attr("height",function(d){     //maintain height and scale it
                return yScale(d);
            });

        d3.select("#update") //update function
            .on("click", function(){

            var numValues = dataset.length;
            var maxValue = 25;
            var nDataset = [];//empty set

            for(var i=0; i<numValues;i++){ //Loop and iterate values
                var newNumber = Math.floor(Math.random()*maxValue);//limit the range of values
                nDataset.push(newNumber);// push values to array
            }

                svg.selectAll("rect")
                .data(nDataset)
                .attr("y", function(d){
                    return h-yScale(d);
                })
                .attr("height",function(d){
                    return yScale(d);
                });

                svg.selectAll("text") //update text to the values
                .data(nDataset)
                .text(function(d){
                        return d;
                })
                .attr("x",function(d,i){
                        return xScale(i)+ xScale.bandwidth()/2;    //x co-ordinate of the text
                })
                .attr("y",function(d){                       //y co-ordinate of the text
                        return h-yScale(d)+padding;
                });
                    
            });

            //update with transition 1
            d3.select("#transition1") 
            .on("click", function(){

            var numValues = dataset.length;
            var maxValue = 25;
            var nDataset = [];//empty set

            for(var i=0; i<numValues;i++){ //Loop and iterate values
                var newNumber = Math.floor(Math.random()*maxValue);//limit the range of values
                nDataset.push(newNumber);// push values to array
            }

                svg.selectAll("rect")
                .data(nDataset)
                .transition()
                .delay(function(d,i){
                    return i/nDataset.length*100;
                })
                .duration(1000)
                .ease(d3.easeElasticOut)
                .attr("y", function(d){
                    return h-yScale(d);
                })
                .attr("height",function(d){
                    return yScale(d);
                });

                svg.selectAll("text") //update text to the values
                .data(nDataset)
                .transition()
                .delay(function(d,i){
                    return i/nDataset.length*100;
                })
                .duration(1000)
                .ease(d3.easeElasticOut)
                .text(function(d){
                        return d;
                })
                .attr("x",function(d,i){
                        return xScale(i)+ xScale.bandwidth()/2;    //x co-ordinate of the text
                })
                .attr("y",function(d){                       //y co-ordinate of the text
                        return h-yScale(d)+padding;
                });
                    
            });

            //update with transition 2
            d3.select("#transition2") 
            .on("click", function(){

            var numValues = dataset.length;
            var maxValue = 25;
            var nDataset = [];//empty set

            for(var i=0; i<numValues;i++){ //Loop and iterate values
                var newNumber = Math.floor(Math.random()*maxValue);//limit the range of values
                nDataset.push(newNumber);// push values to array
            }

                svg.selectAll("rect")
                .data(nDataset)
                .transition()
                .delay(function(d,i){
                    return i/nDataset.length*100;
                })
                .duration(1000)
                .ease(d3.easeBounceIn)
                .attr("y", function(d){
                    return h-yScale(d);
                })
                .attr("height",function(d){
                    return yScale(d);
                });

                svg.selectAll("text") //update text to the values
                .data(nDataset)
                .transition()
                .delay(function(d,i){
                    return i/nDataset.length*100;
                })
                .duration(1000)
                .ease(d3.easeBounceIn)
                .text(function(d){
                        return d;
                })
                .attr("x",function(d,i){
                        return xScale(i)+ xScale.bandwidth()/2;    //x co-ordinate of the text
                })
                .attr("y",function(d){                       //y co-ordinate of the text
                        return h-yScale(d)+padding;
                });
                    
            });

        svg.selectAll("text") //bind text to the values
           .data(dataset)
           .enter()
           .append("text")
           .text(function(d){
                return d;
           })
           .attr("x",function(d,i){
                return xScale(i)+ xScale.bandwidth()/2;    //x co-ordinate of the text
           })
           .attr("y",function(d){                       //y co-ordinate of the text
                return h-yScale(d)+padding;
           })
           .attr("font-size","14px")
           .attr("font-family","Times New Roman")
           .attr("fill","red");

    </script>



<footer style="margin-top: 10px; opacity: 0.3; font-size: 12px;">Data Visualisation  <!--footer-->
    V.M.Karthikeyan
</footer>
</body>
</html>